---
title: "TidyTuesday_2025-05-13"
author: "Ishita Khanna"
date: "`r Sys.Date()`"
output: html_document
runtime: shiny
---

```{r}
library(tidyverse)
library(dplyr)
library(shiny)

vesuvius <- read_csv("data/vesuvius.csv")
```

```{r exploring, include = FALSE}
glimpse(vesuvius)
```

<!-- making an input slider filter as a ui shiny element, range of years -->

```{r}
sliderInput("yearRange", "Select year:",
            min = 2011, max = 2025, value = c(2013, 2025), sep = "")
```

<!-- making an input select filter as a ui shiny element, their review status -->

```{r}
selectInput("review", "Review Level:",
            choices = c("All", "revised", "preliminary"), selected = "All")
```

# Seismic Activity Timeline

### Question:
*How has the number and severity of seismic events changed over the last decade?*

### Approach:
To explore this, I have chosen *Area and Line chart* where users can filter the time period and review level:
 - The **tan area** represents the number of seismic events per year.
 - The **red line** tracks the average magnitude each year.
 
### Answer we are looking for:
 - How has the frequency of seismic activity evolved over time?
 - Are higher magnitude events gradually becoming more or less frequent?
 
```{r}
renderPlot({
  data_filtered <- vesuvius %>%
    filter(year >= input$yearRange[1], year <= input$yearRange[2])

  if (input$review != "All") {
    data_filtered <- data_filtered %>%
      filter(review_level == input$review)
  }
  
  yearly_summary <- data_filtered %>%
    drop_na(duration_magnitude_md) %>%
    group_by(year) %>%
    summarise(
      count = n(),
      avg_md = mean(duration_magnitude_md)
    )

  ggplot(yearly_summary, aes(x = year)) +
    geom_area(aes(y = count), fill = "tan", alpha = 0.4) +
    geom_line(aes(y = avg_md * 100), color = "red", size = 1) +
    scale_y_continuous(
      name = "Event Count",
      sec.axis = sec_axis(~./100, name = "Avg Magnitude (Md)")
    ) +
    labs(
      title = "Seismic Events Count and Average Magnitude per Year",
      subtitle = "Trends in quantity and severity of seismic events (2011â€“2025)",
      x = "Year"
    ) +
    theme_minimal()
})
```

