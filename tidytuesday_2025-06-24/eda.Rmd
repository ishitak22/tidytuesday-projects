---
title: "Global Measles Outbreaks"
author: "Ishita Khanna"
date: "`r Sys.Date()`"
output: 
  html_document:
    theme: flatly
    df_print: tibble
---

```{r setup, include=FALSE}
library(tidyverse)
library(dplyr)
library(tidyr)
library(scales)
library(ggplot2)
library(plotly)
```

```{r dataset, include=FALSE}
cases_year <- read_csv("data/cases_year.csv")
cases_month <- read_csv("data/cases_month.csv")

glimpse(cases_year)
glimpse(cases_month)
```

This report explores global measles and rubella case trends using data from the **WHO Provisional Measles & Rubella Surveillance Dataset (2012â€“2025)**.

The goal of this analysis is to:

 - Analyse **monthly and seasonal outbreak patterns** across countries.
- Visualise how **measles spread over time and geography**.
- Examine **reporting and surveillance quality**.
- Highlight the **preventable human impact**.

```{r eda-summary, include=FALSE}
n_countries <- n_distinct(cases_year$country)
n_regions <- n_distinct(cases_year$region)

measles_median <- comma(median(cases_year$measles_total, na.rm = TRUE))
measles_max <- comma(max(cases_year$measles_total, na.rm = TRUE))

rubella_median <- comma(median(cases_year$rubella_total, na.rm = TRUE))
rubella_max <- comma(max(cases_year$rubella_total, na.rm = TRUE))
```

## Summary of the Dataset

This dataset covers `r n_countries` countries across `r n_regions` global regions. 

The number of measles cases reported per country per year varies widely, with a **median of `r measles_median` cases** and a **maximum of `r measles_max`** in a single country-year. 

Rubella case counts are much lower, with a **median of `r rubella_median` cases** and a **maximum of `r rubella_max`**. This highlights both the variability of outbreaks and under-reporting or low incidence in some regions.

## Monthly Outbreak Fingerprints (Top Countries)

To understand **seasonal patterns** in measles outbreaks, we visualise the monthly distribution of cases across the 12 most affected countries.

This reveals outbreak "fingerprints" of how measles tends to spike during specific months in different regions.

```{r heatmap, echo = FALSE}
top_countries <- cases_month %>%
  group_by(country) %>%
  summarise(total_cases = sum(measles_total, na.rm = TRUE)) %>%
  arrange(desc(total_cases)) %>%
  slice_head(n = 12) %>%
  pull(country)

heatmap_data <- cases_month %>%
  filter(country %in% top_countries) %>%
  group_by(country, month) %>%
  summarise(total_cases = sum(measles_total, na.rm = TRUE), .groups = "drop")

ggplot(heatmap_data, aes(x = factor(month), y = fct_reorder(country, -total_cases), fill = total_cases)) +
  geom_tile(color = "white", linewidth = 0.4) +
  scale_fill_gradient(low = "#fff5f0", high = "#cb181d", name = "cases") +
  labs(
    title = "Monthly Measles Outbreak Patterns",
    x = "Month",
    y = "Country"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    axis.text.x = element_text(size = 10),
    axis.text.y = element_text(size = 10),
    plot.title = element_text(face = "bold", size = 14),
    legend.position = "right"
  )
```

## Bubble Chart: Coverage vs. Incidence 

To better understand how **estimated vaccine coverage** and **measles incidence** relate across countries, this bubble chart compares the two metrics.

- **X-axis**: Estimated vaccine coverage (95 - incidence/100)
- **Y-axis**: Mean annual incidence (per million people)
- **Bubble size**: Total population
- **Color**: WHO region

This chart helps reveal **high-risk countries** those with **large populations**, **low coverage**, and **high incidence**, which should be prioritised for vaccination and surveillance efforts.

```{r bubble_data, include=FALSE, warning=FALSE}
bubble_df <- cases_year %>%
  group_by(country, region) %>%
  summarise(
    mean_incidence = mean(measles_incidence_rate_per_1000000_total_population, na.rm = TRUE),
    total_population = mean(total_population, na.rm = TRUE)
  ) %>%
  filter(!is.na(mean_incidence), mean_incidence > 0, total_population > 0) %>%
  mutate(
    vaccine_coverage = 95 - (mean_incidence / 100), # derived estimate
    bubble_size = sqrt(total_population) / 1000     # scaled for plotting
  )

bubble_df <- bubble_df %>%
  mutate(
    hover_text = paste0(
      "Country: ", country, "\n",
      "Region: ", region, "\n",
      "Incidence: ", round(mean_incidence, 1), "\n",
      "Coverage: ", round(vaccine_coverage, 1), "%\n",
      "Population: ", scales::comma(round(total_population))
    )
  )
```

```{r bubbe_chart, echo=FALSE, warning=FALSE}
bubble_text <- ggplot(bubble_df, aes(x = vaccine_coverage, y = mean_incidence)) +
  geom_point(aes(size = bubble_size, color = region, text = hover_text), alpha = 0.7)  +
  scale_size_continuous(range = c(2, 12), name = "Population\n(scaled approx)") +
  scale_color_brewer(palette = "Set2") +
  labs(
    title = "Measles Incidence vs. Estimated Vaccine Coverage",
    subtitle = "Bubble size represents population (Top countries by incidence)",
    x = "Estimated Vaccine Coverage (%)",
    y = "Mean Measles Incidence per Million",
    color = "Region"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    legend.position = "right",
    plot.title = element_text(face = "bold", size = 14),
    plot.subtitle = element_text(size = 11)
  )

ggplotly(bubble_text, tooltip = "text")
```

## Scatter Plot: Reported Cases vs Incidence Rate

This plot compares **total reported measles cases** with **average incidence rate per million**, colored by WHO region.

- **Top-left**: High incidence but low total cases, possible under-reporting.
- **Top-right**: High incidence and high totals, likely accurate reporting.

This view helps identify countries with potential gaps in **disease surveillance** or **reporting accuracy**.

```{r scatter, echo=FALSE, warning=FALSE}
cases_year %>%
  group_by(country, region) %>%
  summarise(
    total_cases = sum(measles_total, na.rm = TRUE),
    avg_incidence = mean(measles_incidence_rate_per_1000000_total_population, na.rm = TRUE),
    avg_population = mean(total_population, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  filter(avg_incidence > 0, total_cases > 0) %>%
  ggplot(aes(x = total_cases, y = avg_incidence, label = country, color = region)) +
  geom_point(alpha = 0.7) +
  geom_text(check_overlap = TRUE, size = 3, hjust = 1.1) +
  scale_x_log10(labels = comma) +
  scale_y_continuous(labels = comma) +
  scale_color_brewer(palette = "Set2") +
  labs(
    title = "Mismatch Between Reported Cases and Incidence Rate",
    subtitle = "Log-scale reveals anomalies: High incidence but low total cases may indicate under-reporting",
    x = "Total Measles Cases (log scale)",
    y = "Average Incidence per Million",
    color = "WHO Region",
    caption = "Top-left = high incidence, low reporting | Top-right = high incidence & reporting"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    plot.title = element_text(face = "bold", size = 14),
    plot.subtitle = element_text(size = 11),
    legend.position = "right"
  )
```

